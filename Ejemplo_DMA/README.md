# DMA
El direct memory access (DMA) es un periférico que se incluye en los MCU y está orientado a la transferencia de datos sin la necesidad de utilizar la CPU. Para llevar a cabo esta transferencia, el DMA monitorea por su cuenta las banderas que indican cuando un periférico está listo para la siguiente transferencia (por ejemplo, banderas que indican cuando el buffer está vacío o lleno). Esto libera al CPU de realizar lectura o escritura de información, así como cambiar al contexto de la ISR asociada al periférico (cada que se genera una interrupción) o realizar polling, de modo que el CPU puede encargarse de otras tareas, cómo el procesamiento de la información, controlar otros periféricos y realizar cálculos matemáticos; lo cual ayuda a reducir la carga de trabajo del mismo y la latencia, cuando está bien implementado.
## Canales
El DMA cuenta con canales conectados directamente a los periféricos del MCU (usualmente los periféricos UART, I2C, ADC y SPI). Cada canal actúa cómo una máquina de estados independiente que puede solicitar el bus de datos para lectura o escritura en RAM a partir de las prioridades asignadas a cada canal, las cuales son configurables por el usuario. En su forma básica, cada canal está enrutado a uno de estos periféricos a nivel de layout del MCU, (por ejemplo, un canal se conecta con la transferencia y otro con la recepción de datos en un UART). En otros casos, se implementa el uso de un multiplexor para seleccionar qué periférico puede conectarse a un canal.
## Interacción del DMA con el CPU
La interacción entre el DMA y el CPU se ve reflejada en el bus de datos. El DMA actúa como un maestro más, el cual puede tomar el bus de datos para escribir o leer en memoria RAM, al igual que el CPU. Esto puede generar una pequeña latencia por parte del CPU o la pérdida de datos en el buffer de un periférico, si hay mucha demanda del bus de datos, por lo cual se debe tener especial cuidado en la transferencia de datos en un periférico que trabaja a altas velocidades, ya que el DMA puede ocupar el bus de datos con mayor frecuencia.
Por otro lado, el DMA no tiene forma directa de indicarle al CPU que ya terminó de transmitir una cantidad n de datos, por lo cual existen banderas de interrupción asociadas a estos casos, entre las cuales se destaca la de media transmisión y transmisión completa. Cada una ocurre cuando el canal de DMA ha terminado su transferencia de información, de modo que genera una interrupción. Esto puede interpretarse como un indicativo para que se escriban nuevos datos en el bloque de memoria asociado a la transferencia de datos.
## Modos de operación
El DMA funciona bajo el principio: fuente y destino; la cual consta de una fuente (de la cual sale la información) y un destino (el lugar al cual llega dicha información). De este modo, el DMA cuenta con varios modos de operación:
* Periférico a memoria: se utiliza para recepción de datos, en donde el DMA se encarga de almacenar en memoria el dato.
* Memoria a periférico: usado en transmisión de datos, el DMA se encarga de leer la zona de memoria que contiene la información y cargarla en el registro de transferencia del periférico.
* Memoria a memoria: orientado a cargar datos de una zona de memoria a otra, usualmente este modo es utilizado para copiar buffers grandes a otras zonas de memoria e incluso se usa para vaciar los buffers.
# Proceso general de configuración
Al igual que en otros periféricos, el DMA tiene un proceso general de configuración, el cual comienza con la selección del canal asociado al periférico con el que se desea usar el DMA, la configuración de la fuente y el destino, a partir del modo de operación, siendo usualmente direcciones de memoria RAM (a través de punteros) y direcciones de los registros de transferencia de periféricos; así como el tipo de dato que se va a transferir. También se debe configurar el modo de corrimiento de direcciones (concepto relacionado con los buffer de datos, debido a que se puede recorrer cada dirección de memoria, como si fuera un puntero), así como las interrupciones. Por último, se debe activar la transferencia de datos en el canal. Este proceso debe realizarse para cada canal que se desea utilizar.
