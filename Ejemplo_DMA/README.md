# DMA
El direct memory access (DMA) es un perif茅rico que se incluye en los MCU y est谩 orientado a la transferencia de datos sin la necesidad de utilizar la CPU. Para llevar a cabo esta transferencia, el DMA monitorea por su cuenta las banderas que indican cuando un perif茅rico est谩 listo para la siguiente transferencia (por ejemplo, banderas que indican cuando el buffer est谩 vac铆o o lleno). Esto libera al CPU de realizar lectura o escritura de informaci贸n, as铆 como cambiar al contexto de la ISR asociada al perif茅rico (cada que se genera una interrupci贸n) o realizar polling, de modo que el CPU puede encargarse de otras tareas, c贸mo el procesamiento de la informaci贸n, controlar otros perif茅ricos y realizar c谩lculos matem谩ticos; lo cual ayuda a reducir la carga de trabajo del mismo y la latencia, cuando est谩 bien implementado.
## З Canales
El DMA cuenta con canales conectados directamente a los perif茅ricos del MCU (usualmente los perif茅ricos UART, I2C, ADC y SPI). Cada canal act煤a c贸mo una m谩quina de estados independiente que puede solicitar el bus de datos para lectura o escritura en RAM a partir de las prioridades asignadas a cada canal, las cuales son configurables por el usuario. En su forma b谩sica, cada canal est谩 enrutado a uno de estos perif茅ricos a nivel de layout del MCU, (por ejemplo, un canal se conecta con la transferencia y otro con la recepci贸n de datos en un UART). En otros casos, se implementa el uso de un multiplexor para seleccionar qu茅 perif茅rico puede conectarse a un canal.
## З Interacci贸n del DMA con el CPU
La interacci贸n entre el DMA y el CPU se ve reflejada en el bus de datos. El DMA act煤a como un maestro m谩s, el cual puede tomar el bus de datos para escribir o leer en memoria RAM, al igual que el CPU. Esto puede generar una peque帽a latencia por parte del CPU o la p茅rdida de datos en el buffer de un perif茅rico, si hay mucha demanda del bus de datos, por lo cual se debe tener especial cuidado en la transferencia de datos en un perif茅rico que trabaja a altas velocidades, ya que el DMA puede ocupar el bus de datos con mayor frecuencia.
Por otro lado, el DMA no tiene forma directa de indicarle al CPU que ya termin贸 de transmitir una cantidad n de datos, por lo cual existen banderas de interrupci贸n asociadas a estos casos, entre las cuales se destaca la de media transmisi贸n y transmisi贸n completa. Cada una ocurre cuando el canal de DMA ha terminado su transferencia de informaci贸n, de modo que genera una interrupci贸n. Esto puede interpretarse como un indicativo para que se escriban nuevos datos en el bloque de memoria asociado a la transferencia de datos.
## З Modos de operaci贸n
El DMA funciona bajo el principio: fuente y destino; la cual consta de una fuente (de la cual sale la informaci贸n) y un destino (el lugar al cual llega dicha informaci贸n). De este modo, el DMA cuenta con varios modos de operaci贸n:
* Perif茅rico a memoria: se utiliza para recepci贸n de datos, en donde el DMA se encarga de almacenar en memoria el dato.
* Memoria a perif茅rico: usado en transmisi贸n de datos, el DMA se encarga de leer la zona de memoria que contiene la informaci贸n y cargarla en el registro de transferencia del perif茅rico.
* Memoria a memoria: orientado a cargar datos de una zona de memoria a otra, usualmente este modo es utilizado para copiar buffers grandes a otras zonas de memoria e incluso se usa para vaciar los buffers.
# З Proceso general de configuraci贸n
Al igual que en otros perif茅ricos, el DMA tiene un proceso general de configuraci贸n, el cual comienza con la selecci贸n del canal asociado al perif茅rico con el que se desea usar el DMA, la configuraci贸n de la fuente y el destino, a partir del modo de operaci贸n, siendo usualmente direcciones de memoria RAM (a trav茅s de punteros) y direcciones de los registros de transferencia de perif茅ricos; as铆 como el tipo de dato que se va a transferir. Tambi茅n se debe configurar el modo de corrimiento de direcciones (concepto relacionado con los buffer de datos, debido a que se puede recorrer cada direcci贸n de memoria, como si fuera un puntero), as铆 como las interrupciones. Por 煤ltimo, se debe activar la transferencia de datos en el canal. Este proceso debe realizarse para cada canal que se desea utilizar.
